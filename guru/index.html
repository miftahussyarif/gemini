<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presensi Al Qodiriyah</title>
    <link rel="icon" href="https://alqodiriyah.sch.id/wp-content/uploads/2022/01/cropped-LOGO-SMK-32x32.png" sizes="32x32">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .form-container {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .popup-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .hidden {
            display: none !important;
        }
        .blur-content {
            filter: blur(5px);
            pointer-events: none;
        }
    </style>
</head>
<body class="min-h-screen gradient-bg">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="text-center text-white">
            <div class="spinner mx-auto mb-4"></div>
            <p class="text-lg">Memverifikasi lokasi Anda...</p>
            <p class="text-sm opacity-75 mt-2">Mohon izinkan akses lokasi</p>
        </div>
    </div>

    <!-- Location Error Popup -->
    <div id="locationErrorPopup" class="popup-modal hidden">
        <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center shadow-2xl">
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
            </div>
            <h3 class="text-xl font-bold text-gray-800 mb-2">Akses Ditolak</h3>
            <p class="text-red-600 font-semibold mb-4">Lokasi absensi Anda terlalu jauh.</p>
            <p class="text-gray-600 text-sm mb-6">Anda harus berada dalam radius maksimal 300 meter dari lokasi yang ditentukan untuk mengakses formulir ini.</p>
            <button onclick="retryLocation()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                Coba Lagi
            </button>
        </div>
    </div>

    <!-- Permission Denied Popup -->
    <div id="permissionDeniedPopup" class="popup-modal hidden">
        <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center shadow-2xl">
            <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg class="w-8 h-8 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
            </div>
            <h3 class="text-xl font-bold text-gray-800 mb-2">Izin Lokasi Diperlukan</h3>
            <p class="text-gray-600 mb-4">Aplikasi ini memerlukan akses lokasi untuk memverifikasi kehadiran Anda.</p>
            <p class="text-sm text-gray-500 mb-6">Silakan izinkan akses lokasi di browser Anda dan coba lagi.</p>
            <button onclick="retryLocation()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                Coba Lagi
            </button>
        </div>
    </div>

    <!-- Main Content Container -->
    <div id="mainContent" class="blur-content">
    <!-- Header Section -->
    <header class="text-white py-5 px-1">

    </header>

    <!-- Main Content -->
    <main class="px-3 pb-16">
        <div class="max-w-4xl mx-auto">
            <!-- Form Container -->
            <div class="bg-white rounded-2xl form-container overflow-hidden">
                <!-- Form Header -->
                <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 text-center">
                    <h2 class="text-3xl font-semibold mb-2">Form Presensi Kehadiran</h2>
                    <p class="text-blue-100"><strong><span id="tanggal-jakarta"></span><script>document.getElementById('tanggal-jakarta').textContent = new Intl.DateTimeFormat('id-ID', { dateStyle: 'full', timeZone: 'Asia/Jakarta' }).format(new Date());</script></strong>
    </p>
                    <p style="font-size: 2em; font-family: monospace;">
        <span id="jam-jakarta"></span><script>setInterval(() => { document.getElementById('jam-jakarta').textContent = new Intl.DateTimeFormat('id-ID', { timeStyle: 'medium', timeZone: 'Asia/Jakarta' }).format(new Date()); }, 1000);</script>
    </p>
                </div>

                <!-- Google Form Embed -->
                <div class="p-2">
                    <div class="bg-gray-50 rounded-xl p-2 border-0 border-dashed border-gray-300">
                        <!-- Sample iframe - Replace src with your Google Form URL -->
                        <iframe 
                            src="https://docs.google.com/forms/d/e/YOURFORMID/viewform?embedded=true" 
                            width="100%"
                            height="800"
                            >
                        </iframe>

                        <!-- Instructions -->

                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="text-white text-center py-8 px-4 border-t border-white border-opacity-20">
        <p class="opacity-75">&copy; 2025 Al Qodiriyah.<a href="https://www.instagram.com/em_miftahussyarif/"> Developed by Avicena</a></p>
    </footer>
    </div> <!-- End Main Content Container -->

    <script>
        // Target location coordinates (Yogyakarta area)
        const TARGET_LAT = -7.3962206;
        const TARGET_LNG = 110.1721782;
        const MAX_DISTANCE = 300; // meters

        // Calculate distance between two coordinates using Haversine formula
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371000; // Earth's radius in meters
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                     Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                     Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Show popup
        function showPopup(popupId) {
            document.getElementById(popupId).classList.remove('hidden');
        }

        // Hide popup
        function hidePopup(popupId) {
            document.getElementById(popupId).classList.add('hidden');
        }

        // Show main content
        function showMainContent() {
            document.getElementById('loadingOverlay').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('blur-content');
        }

        // Hide main content
        function hideMainContent() {
            document.getElementById('mainContent').classList.add('blur-content');
        }

        // Retry location check
        function retryLocation() {
            hidePopup('locationErrorPopup');
            hidePopup('permissionDeniedPopup');
            document.getElementById('loadingOverlay').classList.remove('hidden');
            checkLocation();
        }

        // Main location checking function
        function checkLocation() {
            if (!navigator.geolocation) {
                showPopup('permissionDeniedPopup');
                return;
            }

            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 60000
            };

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const userLat = position.coords.latitude;
                    const userLng = position.coords.longitude;
                    
                    const distance = calculateDistance(userLat, userLng, TARGET_LAT, TARGET_LNG);
                    
                    console.log(`User location: ${userLat}, ${userLng}`);
                    console.log(`Target location: ${TARGET_LAT}, ${TARGET_LNG}`);
                    console.log(`Distance: ${Math.round(distance)} meters`);
                    
                    if (distance <= MAX_DISTANCE) {
                        // Location is valid, show the form
                        showMainContent();
                    } else {
                        // Location is too far, show error
                        hideMainContent();
                        showPopup('locationErrorPopup');
                    }
                },
                function(error) {
                    console.error('Geolocation error:', error);
                    hideMainContent();
                    
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            showPopup('permissionDeniedPopup');
                            break;
                        case error.POSITION_UNAVAILABLE:
                        case error.TIMEOUT:
                            showPopup('permissionDeniedPopup');
                            break;
                        default:
                            showPopup('permissionDeniedPopup');
                            break;
                    }
                },
                options
            );
        }

        // Start location check when page loads
        window.addEventListener('load', function() {
            checkLocation();
        });
    </script>
    
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9813f4b4377bd25b',t:'MTc1ODIzMTE0NS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>